<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>ì§€ê¸ˆë°ˆ - ê¸€ë¡œë²Œ ìœ í–‰ íŠ¸ë Œë“œ</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  
  <style>
    body { font-family: 'Pretendard', sans-serif; background-color: #ffffff; color: #0f172a; margin: 0; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .card-zoom { transition: transform 0.45s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s ease; }
    .meme-card-wrapper { will-change: transform, opacity; backface-visibility: hidden; }
    @keyframes pulse-soft { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    .animate-pulse-soft { animation: pulse-soft 2s infinite ease-in-out; }
  </style>

  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.2.0",
      "react-dom": "https://esm.sh/react-dom@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
      "@google/genai": "https://esm.sh/@google/genai"
    }
  }
  </script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useMemo, useRef, useLayoutEffect } from 'react';
    import { createRoot } from 'react-dom/client';
    import { GoogleGenAI, Type } from "@google/genai";

    // ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë³´ì—¬ì¤„ ê¸°ë³¸ ë°ì´í„°
    const FALLBACK_DATA = {
      "KR": [
        {
          "id": "hot",
          "name": "ì§€ê¸ˆ í•«í´ë¦½",
          "top": [{ "title": "íŠ¸ë Œë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...", "preview": "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExOHlxMHFxZHBxZHBxZHBxZHBxZHBxZHBxZHBxZHBxZHBxZHBxJmVwPXYxX2ludGVybmFsX2dpZl9ieV9pZCZjdD1n/EatwJZRUIv41G/giphy.gif", "link": "https://www.youtube.com" }],
          "list": []
        }
      ]
    };

    const COUNTRIES = [
      { code: 'KR', flag: 'ğŸ‡°ğŸ‡·' }, { code: 'US', flag: 'ğŸ‡ºğŸ‡¸' }, { code: 'JP', flag: 'ğŸ‡¯ğŸ‡µ' },
      { code: 'FR', flag: 'ğŸ‡«ğŸ‡·' }, { code: 'DE', flag: 'ğŸ‡©ğŸ‡ª' }, { code: 'BR', flag: 'ğŸ‡§ğŸ‡·' },
      { code: 'ID', flag: 'ğŸ‡®ğŸ‡©' }, { code: 'GLOBAL', flag: 'ğŸŒ' }
    ];

    const MemeCard = ({ item, isTop, isFocused, onOpenLink }) => {
      const [imgError, setImgError] = useState(false);
      const youtubeId = useMemo(() => {
        const match = item.link.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
        return match ? match[1] : null;
      }, [item.link]);
      const thumb = useMemo(() => {
        if (youtubeId) return `https://img.youtube.com/vi/${youtubeId}/hqdefault.jpg`;
        return item.preview || `https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=400`;
      }, [youtubeId, item.preview]);

      return (
        <div className="relative" style={{ width: '130px', height: '184px' }}>
          <button onClick={() => onOpenLink(item.link)} className="card-zoom block w-full h-full text-left outline-none"
            style={{ transform: isFocused ? 'scale(1.1) translateY(-8px)' : 'scale(0.92)', opacity: isFocused ? 1 : 0.45, zIndex: isFocused ? 50 : 10 }}>
            <div className={`relative w-full h-full rounded-2xl overflow-hidden bg-slate-200 ${isFocused ? 'shadow-2xl' : 'shadow-md'}`}>
              <img src={imgError ? 'https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=400' : thumb} className="absolute inset-0 w-full h-full object-cover" onError={() => setImgError(true)} />
              <div className="absolute inset-x-0 bottom-0 h-2/3 bg-gradient-to-t from-black/90 via-black/40 to-transparent" />
              <div className="absolute inset-0 p-3 flex flex-col justify-end">
                {isTop && <span className="absolute top-2.5 left-2.5 bg-yellow-400 text-black text-[9px] font-black px-1.5 py-0.5 rounded-[4px]">TOP</span>}
                <h3 className="text-white font-bold text-[10px] leading-tight line-clamp-2">{item.title}</h3>
              </div>
            </div>
          </button>
        </div>
      );
    };

    const MemeSection = ({ category, onOpenLink }) => {
      const scrollRef = useRef(null);
      const [activeIndex, setActiveIndex] = useState(0);
      const CARD_WIDTH = 130;
      const ITEM_FULL_WIDTH = CARD_WIDTH + 12;

      const items = useMemo(() => {
        const raw = [...(category.top || []), ...(category.list || [])];
        if (raw.length === 0) return [];
        let base = [...raw]; while (base.length < 10) base = [...base, ...raw];
        return [...base, ...base, ...base];
      }, [category]);

      const oneSetCount = items.length / 3;

      useLayoutEffect(() => {
        if (scrollRef.current && items.length > 0) {
          scrollRef.current.scrollLeft = (oneSetCount * ITEM_FULL_WIDTH) - (scrollRef.current.offsetWidth / 2) + (CARD_WIDTH / 2);
          setActiveIndex(oneSetCount);
        }
      }, [category.name, items.length]);

      const handleScroll = () => {
        const el = scrollRef.current;
        if (!el) return;
        const center = el.getBoundingClientRect().left + el.offsetWidth / 2;
        const cards = el.querySelectorAll('.meme-card-wrapper');
        let closestIdx = 0; let minDist = Infinity;
        cards.forEach((card, i) => {
          const rect = card.getBoundingClientRect();
          const dist = Math.abs(center - (rect.left + rect.width / 2));
          if (dist < minDist) { minDist = dist; closestIdx = i; }
        });
        setActiveIndex(closestIdx);
      };

      return (
        <section className="py-8 overflow-hidden">
          <div className="px-5 mb-1 flex items-baseline gap-2">
            <h2 className="text-xl font-black text-slate-900 tracking-tighter">{category.name}</h2>
            {category.isAI && <span className="text-[9px] bg-indigo-600 text-white px-1.5 py-0.5 rounded-full font-black animate-pulse-soft">AI LIVE</span>}
          </div>
          <div ref={scrollRef} onScroll={handleScroll} className="flex gap-3 overflow-x-auto no-scrollbar py-10 snap-x snap-mandatory">
            {items.map((item, idx) => (
              <div key={idx} className="meme-card-wrapper flex-none snap-center">
                <MemeCard item={item} isTop={idx % (category.top.length + category.list.length) < category.top.length} isFocused={idx === activeIndex} onOpenLink={onOpenLink} />
              </div>
            ))}
          </div>
        </section>
      );
    };

    const App = () => {
      const [activeCountry, setActiveCountry] = useState('KR');
      const [allData, setAllData] = useState({});
      const [loading, setLoading] = useState(true);
      const [aiSearching, setAiSearching] = useState(false);

      const loadData = async () => {
        setLoading(true);
        try {
          const res = await fetch(`./trends.json?t=${Date.now()}`);
          if (!res.ok) {
            setAllData(FALLBACK_DATA);
            return;
          }
          const data = await res.json();
          setAllData(data);
        } catch (e) { 
          setAllData(FALLBACK_DATA);
        } finally { 
          setLoading(false); 
        }
      };

      useEffect(() => { loadData(); }, []);

      const discoverWithAI = async () => {
        setAiSearching(true);
        const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
        try {
          const response = await ai.models.generateContent({
            model: 'gemini-3-flash-preview',
            contents: `Find the top 5 viral memes or hot YouTube clips in ${activeCountry} right now.`,
            config: {
              tools: [{ googleSearch: {} }],
              responseMimeType: "application/json",
              responseSchema: {
                type: Type.OBJECT,
                properties: {
                  trends: {
                    type: Type.ARRAY,
                    items: {
                      type: Type.OBJECT,
                      properties: {
                        title: { type: Type.STRING },
                        link: { type: Type.STRING },
                        preview: { type: Type.STRING }
                      },
                      required: ["title", "link"]
                    }
                  }
                }
              }
            }
          });
          const result = JSON.parse(response.text);
          const aiCategory = { id: 'ai-' + Date.now(), name: 'AI ì‹¤ì‹œê°„ ë°œê²¬', isAI: true, top: result.trends, list: [] };
          setAllData(prev => ({ ...prev, [activeCountry]: [aiCategory, ...(prev[activeCountry] || [])] }));
        } catch (e) { 
          alert("AI ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."); 
        } finally { 
          setAiSearching(false); 
        }
      };

      const currentCategories = allData[activeCountry] || [];

      return (
        <div className="min-h-screen bg-white select-none">
          <header className="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-slate-50">
            <div className="px-5 py-5 flex items-center justify-between">
              <div className="flex items-center gap-2">
                <div className="bg-indigo-600 w-6 h-6 rounded flex items-center justify-center"><span className="text-white font-black text-[10px]">M</span></div>
                <h1 className="text-xl font-black tracking-tighter">ì§€ê¸ˆë°ˆ</h1>
              </div>
              <button onClick={discoverWithAI} disabled={aiSearching} className={`px-3 py-1.5 rounded-full text-[11px] font-black transition-all ${aiSearching ? 'bg-slate-100 text-slate-400' : 'bg-indigo-50 text-indigo-600 active:scale-95'}`}>
                {aiSearching ? 'ğŸ¤– ê²€ìƒ‰ ì¤‘...' : 'âœ¨ AI ì‹¤ì‹œê°„ ë°œê²¬'}
              </button>
            </div>
            <nav className="px-5 pb-4 flex gap-4 overflow-x-auto no-scrollbar">
              {COUNTRIES.map(c => (
                <button key={c.code} onClick={() => setActiveCountry(c.code)} className={`flex-none transition-all ${activeCountry === c.code ? 'scale-125 opacity-100' : 'opacity-30 scale-100'}`}>
                  <span className="text-2xl">{c.flag}</span>
                </button>
              ))}
            </nav>
          </header>
          <main>
            {loading ? <div className="p-10 text-center text-slate-300">ë¡œë”© ì¤‘...</div> : 
             currentCategories.length > 0 ? currentCategories.map(cat => <MemeSection key={cat.id} category={cat} onOpenLink={url => window.open(url, '_blank')} />) :
             <div className="py-20 text-center px-10">
               <p className="text-slate-400 text-sm">íŠ¸ë Œë“œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
               <button onClick={loadData} className="mt-4 text-indigo-500 font-bold text-xs underline">ìƒˆë¡œê³ ì¹¨</button>
             </div>
            }
          </main>
          <footer className="py-10 text-center opacity-20 text-[10px] font-bold uppercase tracking-widest">Â© 2025 Daily HotCool Meme</footer>
        </div>
      );
    };

    const container = document.getElementById('root');
    const root = createRoot(container);
    root.render(<App />);
  </script>
</body>
</html>
